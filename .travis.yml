os: osx
osx_image: xcode10.2
language: objective-c
sudo: false
env:
  global:
  - THEOS=~/theos
before_install:
  - brew update
  - brew install dpkg ldid
  - git clone --recursive git://github.com/theos/theos.git ~/theos
script:
  - "export VERSION=$(grep 'Version: ' control | sed 's/^.*: //')"
  - "export DESCRIPTION=$(awk '/## v$VERSION/{getline; print}' README.md)"
  - "export FILENAME='packages/'\"$(grep 'Package: ' control | sed 's/^.*: //')\"'_'\"$VERSION\"'_iphoneos-arm.deb'"
  - make package
before_deploy:
  - git config --local user.name "Jeff Rescignano"
  - git config --local user.email "jeff@jeffresc.dev"
  - if [ "$TRAVIS_BRANCH" == "release" ]; then git tag -a v$VERSION -m "$DESCRIPTION"; fi
deploy:
  provider: releases
  api_key:
    secure: ExwL5viPYJJLusFX1t2ubQq+LWWsgjnn2wfu+6R5YgmN9r8Hg8LpZVu8J+B3mv7jQ+H3xWG3KMBWJSrIsVd5XcJLd42v4Ub82aH+8GZoWn9g3nE6Do8DkmPsyajm+5+/AP3jd5Wn9P0PtFa3tCLnRUrCMSfbcqrIwpIERS6aAeNWTFtYuY/hLUNqDfbvnplvTTpYQvqtH478KFai7a+HPwuUQ9Am0APVV3ZWwCjx+voygvKkZq0NskiaWJ/GkS37fkPjC+jlhdx7LugzBj+cXOXSxi2eiuMv7HDO1n5qK/ug2jBK1recDgMf43W+KfwoxIPUxg+Zi2yOGaeIASclMeuYBW0LHzAZeB9bpZg5hIuFsBYGaw8aM0nBHKeUDNFjlaOf7fefF84lQxddQS1ac0GPZNbr4CdHFf64vlHt2Lv64GlawLHtPNAxkEjPwpLQrBw0I6T3rSo6lpaV8KV+zXfVtSI4PyrjN/EgVvUTI6VPcGWCYI8qOeSlLB3bh+EmKTZxbL7xpoITtUuWlPR3pk/mnB8D7UcjHhEnK/vu5KWCdjex8dEk57dC5Ejc3KUFHQlfmAun/PuFnJVdsb26NrB2Can1EzmAV4nWjKv/TeI6Vv2vxGZivjqWS74oqqJcrHSFWLF2PuzD8eVtZeEa6ZLYLIr97JLgKVmCf0Tfeqk=
  file: $FILENAME
  skip_cleanup: true
  on:
    branches:
      only:
        - release
branches:
  except:
  - /^untagged/
